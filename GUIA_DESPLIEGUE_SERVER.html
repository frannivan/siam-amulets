<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a de Despliegue - Oracle Cloud</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --code-bg: #f8f9fa;
            --light-bg: #ecf0f1;
            --text-color: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }

        h1,
        h2,
        h3 {
            color: var(--primary-color);
            margin-top: 1.5em;
        }

        h1 {
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 10px;
            text-align: center;
        }

        h2 {
            border-left: 5px solid var(--accent-color);
            padding-left: 10px;
            background: var(--light-bg);
            padding: 10px;
            border-radius: 0 5px 5px 0;
        }

        .intro {
            background-color: #e8f6f3;
            border: 1px solid #a2d9ce;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        code {
            background-color: #eee;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            color: #c7254e;
        }

        pre {
            background-color: var(--code-bg);
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            position: relative;
        }

        pre code {
            background-color: transparent;
            color: #333;
            padding: 0;
        }

        .step {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .step-number {
            display: inline-block;
            background-color: var(--accent-color);
            color: white;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }

        .important {
            background-color: #fff3cd;
            border-left: 5px solid var(--warning-color);
            padding: 15px;
            margin: 15px 0;
        }

        .urls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .url-card {
            flex: 1;
            padding: 20px;
            background: var(--primary-color);
            color: white;
            border-radius: 8px;
            text-align: center;
        }

        .url-card a {
            color: var(--accent-color);
            font-weight: bold;
            font-size: 1.2em;
            text-decoration: none;
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .url-card a:hover {
            background: #eee;
        }
    </style>
</head>

<body>

    <h1>üöÄ Gu√≠a Maestra de Despliegue</h1>
    <p style="text-align: center; color: #7f8c8d;">Actualizada y Probada: 16 de Enero 2026</p>

    <div class="intro">
        <p><strong>Resumen:</strong> Esta gu√≠a cubre el despliegue de <strong>BarberShop</strong> (Puerto 8080) y
            <strong>AmuletsOfSiam</strong> (Puerto 8081) en la misma instancia de Oracle Cloud, configurando Nginx como
            proxy inverso.</p>
    </div>

    <div class="step">
        <h2><span class="step-number">1</span> Preparaci√≥n Local (CR√çTICO)</h2>
        <p>Antes de subir nada, aseg√∫rate de que tu configuraci√≥n local sea correcta.</p>

        <h3>A. Configurar URLs (http vs https)</h3>
        <div class="important">
            ‚ö† <strong>IMPORTANTE:</strong> El servidor NO tiene SSL configurado a√∫n. Debes usar <code>http://</code>
            (sin S).
        </div>

        <p><strong>BarberShop</strong> (<code>environment.prod.ts</code>):</p>
        <pre><code>export const environment = {
  production: true,
  apiUrl: 'http://143.47.101.209/api',
  tenantId: 'barbershop'
};</code></pre>

        <p><strong>AmuletsOfSiam</strong> (<code>environment.prod.ts</code>):</p>
        <pre><code>export const environment = {
  production: true,
  apiUrl: 'http://143.47.101.209/api/amulets'
};</code></pre>

        <h3>B. Compilar Frontends (Localmente)</h3>
        <p>Ejecuta esto en tu Mac para generar los archivos compilados:</p>
        <pre><code># 1. Compilar BarberShop
cd /Users/franivan/Documents/ProyectosWeb/BarberShop/frontend
npm install --legacy-peer-deps
rm -rf dist/
ng build --configuration production

# 2. Compilar AmuletsOfSiam
cd /Users/franivan/Documents/ProyectosWeb/GigAmulets/AmuletsOfSiam/frontend
npm install
rm -rf dist/
ng build --configuration production</code></pre>
    </div>

    <div class="step">
        <h2><span class="step-number">2</span> Subir Archivos al Servidor</h2>
        <p>Usa <code>scp</code> desde tu Mac para subir las carpetas compiladas.</p>
        <pre><code># Subir BarberShop
ssh -i ~/Downloads/ssh-key-2026-01-09.key ubuntu@143.47.101.209 "mkdir -p ~/barbershop-files"
scp -r -i ~/Downloads/ssh-key-2026-01-09.key dist/barbershop-frontend/* ubuntu@143.47.101.209:~/barbershop-files

# Subir AmuletsOfSiam
ssh -i ~/Downloads/ssh-key-2026-01-09.key ubuntu@143.47.101.209 "mkdir -p ~/amulets-files"
scp -r -i ~/Downloads/ssh-key-2026-01-09.key dist/frontend/* ubuntu@143.47.101.209:~/amulets-files</code></pre>
    </div>

    <div class="step">
        <h2><span class="step-number">3</span> Instalaci√≥n en el Servidor</h2>
        <p>Con√©ctate por SSH: <code>ssh -i Key.key ubuntu@143.47.101.209</code> y ejecuta:</p>

        <h3>A. Mover Frontends</h3>
        <pre><code># 1. BarberShop
sudo rm -rf /var/www/barbershop/*
sudo mkdir -p /var/www/barbershop
sudo mv ~/barbershop-files/* /var/www/barbershop/
# Fix 'browser' folder
if [ -d "/var/www/barbershop/browser" ]; then
    sudo mv /var/www/barbershop/browser/* /var/www/barbershop/
    sudo rm -rf /var/www/barbershop/browser
fi

# 2. AmuletsOfSiam
sudo rm -rf /var/www/amulets/*
sudo mkdir -p /var/www/amulets
sudo mv ~/amulets-files/* /var/www/amulets/
# Fix 'browser' folder
if [ -d "/var/www/amulets/browser" ]; then
    sudo mv /var/www/amulets/browser/* /var/www/amulets/
    sudo rm -rf /var/www/amulets/browser
fi

# Permisos
sudo chown -R ubuntu:ubuntu /var/www
sudo chmod -R 755 /var/www</code></pre>

        <h3>B. Iniciar Backends</h3>
        <pre><code># Matar procesos viejos
pkill -f "BarberShopUAT"
pkill -f "siam-amulets"

# Iniciar BarberShop (8080)
cd ~
nohup java -jar ~/proyects/BarberShopUAT/backend/target/backend-0.0.1-SNAPSHOT.jar > barbershop.log 2>&1 &

# Iniciar Amulets (8081)
cd ~
nohup java -jar ~/proyects/siam-amulets/backend/target/backend-0.0.1-SNAPSHOT.jar > amulets.log 2>&1 &</code></pre>
    </div>

    <div class="step">
        <h2><span class="step-number">4</span> Configuraci√≥n Nginx</h2>
        <p>Archivo: <code>/etc/nginx/conf.d/default.conf</code></p>
        <pre><code>server {
    listen 80;
    server_name _;

    # --- BARBERSHOP ---
    location / {
        root /var/www/barbershop;
        try_files $uri $uri/ /index.html;
    }
    location /api/ {
        proxy_pass http://localhost:8080/api/;
        proxy_set_header Host $host;
        # ... headers CORS ...
    }

    # --- AMULETS ---
    location /amulets/ {
        alias /var/www/amulets/;
        try_files $uri $uri/ /amulets/index.html;
    }
    location /api/amulets/ {
        proxy_pass http://localhost:8081/api/;
        proxy_set_header Host $host;
        # ... headers CORS ...
    }
}</code></pre>
        <p>Reiniciar: <code>sudo systemctl restart nginx</code></p>
    </div>

    <div class="urls">
        <div class="url-card">
            <h3>üíà BarberShop</h3>
            <a href="http://143.47.101.209/" target="_blank">Abrir Web</a>
        </div>
        <div class="url-card" style="background: #8e44ad;">
            <h3>üßø AmuletsOfSiam</h3>
            <a href="http://143.47.101.209/amulets/" target="_blank">Abrir Web</a>
        </div>
    </div>

</body>

</html>